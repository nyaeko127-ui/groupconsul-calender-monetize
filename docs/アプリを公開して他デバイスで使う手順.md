# アプリを他のデバイスでも使えるように公開する手順

このガイドでは、**知識がなくても** ステップに沿って進めれば、アプリをインターネットに公開し、スマホや他のPCからも使えるようにする方法を説明します。

---

## 全体の流れ（3つの大きなステップ）

| ステップ | やること | かかる目安 |
|---------|----------|------------|
| **A** | コードを GitHub に上げる | 10分 |
| **B** | Vercel でアプリを公開する（本番URLを取得） | 15分 |
| **C** | Google の設定を「本番URL」に対応させる | 10分 |

全部できたら、**本番のURL**（例: `https://〇〇.vercel.app`）を他のデバイスで開くだけで使えます。

---

# ステップ A：コードを GitHub に上げる

Vercel は「GitHub のリポジトリから」アプリをデプロイするため、まずこのプロジェクトを GitHub に上げます。

## A-1. GitHub のアカウントを用意する

- まだの場合は [https://github.com](https://github.com) でアカウントを作成してください。

## A-2. 新しいリポジトリを作る

1. GitHub にログインして、右上の **「+」** → **「New repository」** をクリック
2. **Repository name** に好きな名前を入力（例: `gurukon-calendar`）
3. **Public** を選ぶ
4. **「Create repository」** をクリック（README などは追加しなくてOK）

## A-3. 自分のPCでターミナルを開く

- Mac: **ターミナル** アプリを開く
- Windows: **コマンドプロンプト** または **PowerShell** を開く

## A-4. プロジェクトのフォルダに移動する

```bash
cd マネタイズグルコン
```

※ 実際のフォルダ名が違う場合は、その名前に変えてください。`cd` のあとは半角スペース1つ入れてからフォルダ名を打ちます。

## A-5. Git が初期化されているか確認する

次のコマンドを打ちます。

```bash
git status
```

- **「fatal: not a git repository」** と出た場合 → A-6 へ（初めて Git を使う）
- **「On branch 〇〇」** のように出た場合 → A-7 へ（すでに Git は使っている）

## A-6. Git を初期化する（A-5 で「fatal」と出た人だけ）

```bash
git init
```

## A-7. すべてのファイルをコミットする

```bash
git add .
git commit -m "Initial commit"
```

「nothing to commit」と出た場合は、すでにコミット済みなのでそのまま A-8 へ。

## A-8. GitHub のリポジトリとつなげる

1. GitHub の **作成したリポジトリのページ** を開く
2. 緑色の **「Code」** ボタンを押す
3. **HTTPS** のタブで表示されている URL をコピー（例: `https://github.com/あなたのID/gurukon-calendar.git`）
4. ターミナルで次を実行（URL は自分のリポジトリのURLに置き換える）

```bash
git remote add origin https://github.com/あなたのユーザー名/リポジトリ名.git
```

## A-9. コードを GitHub にプッシュする

```bash
git branch -M main
git push -u origin main
```

- GitHub のユーザー名とパスワード（またはトークン）を聞かれたら入力する
- パスワードが通らない場合は、GitHub の **Settings → Developer settings → Personal access tokens** でトークンを作り、そのトークンをパスワードの代わりに入力する

ここまでで、コードが GitHub に上がっています。

---

# ステップ B：Vercel でアプリを公開する

Vercel を使うと、Next.js アプリを簡単に本番公開できます。

## B-1. Vercel に登録する

1. [https://vercel.com](https://vercel.com) を開く
2. **「Sign Up」** から **「Continue with GitHub」** を選ぶ
3. GitHub の認証を許可する

## B-2. 新しいプロジェクトを作る

1. ダッシュボードで **「Add New...」** → **「Project」** をクリック
2. **Import Git Repository** の一覧から、さきほどプッシュした **リポジトリ** を選ぶ
3. **「Import」** をクリック

## B-3. 環境変数を設定する（重要）

**「Configure Project」** の画面で、**Environment Variables** を開きます。

次の **名前** と **値** を1つずつ追加してください。値は `.env.local` に書いてあるものをコピーして使います。

| 名前 (Name) | 値 (Value) | どこにあるか |
|------------|------------|--------------|
| `NEXT_PUBLIC_SUPABASE_URL` | （SupabaseのURL） | .env.local の同じ名前 |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | （Supabaseのキー） | .env.local の同じ名前 |
| `ADMIN_EMAILS` | 運営にしたいメール（例: a@gmail.com） | .env.local の同じ名前 |
| `GOOGLE_CLIENT_ID` | （GoogleのクライアントID） | .env.local |
| `GOOGLE_CLIENT_SECRET` | （Googleのシークレット） | .env.local |
| `NEXTAUTH_URL` | **ここは後で入れる**（ステップ B-6） | いったん空でOK |
| `NEXTAUTH_SECRET` | ランダムな長い文字列（後述） | 新規作成 |

**NEXTAUTH_SECRET の作り方（1回だけ）：**

- ターミナルで `openssl rand -base64 32` を実行して出た文字列をコピーし、Vercel の **Value** に貼り付ける  
- または [https://generate-secret.vercel.app/32](https://generate-secret.vercel.app/32) で生成した文字列を使う

**注意：** `.env.local` は GitHub に上げないでください（通常は .gitignore に入っています）。値は手動で Vercel にコピーします。

## B-4. デプロイを開始する

1. 環境変数を全部入れたら **「Deploy」** をクリック
2. ビルドが始まります（1〜3分ほど）
3. 完了すると **「Congratulations!」** と表示され、**本番のURL**（例: `https://gurukon-calendar-xxx.vercel.app`）が表示されます。このURLをコピーしてメモしておく

## B-5. いったんログインが 404 になる場合

最初のデプロイでは `NEXTAUTH_URL` が空だと、Google ログイン後にエラーになることがあります。次の B-6 で設定すれば直ります。

## B-6. NEXTAUTH_URL を本番URLに設定する

1. Vercel のダッシュボードで、今デプロイした **プロジェクト** を開く
2. 上の **「Settings」** タブをクリック
3. 左メニューで **「Environment Variables」** を開く
4. **NEXTAUTH_URL** を追加（または編集）する  
   - **Name:** `NEXTAUTH_URL`  
   - **Value:** 本番のURL（**末尾にスラッシュなし**）  
     例: `https://gurukon-calendar-xxx.vercel.app`
5. **「Save」** を押す
6. もう一度デプロイする：**「Deployments」** タブ → いちばん上のデプロイの **「⋯」** → **「Redeploy」**

ここまでで、**アプリはインターネット上に公開された状態**です。ただし、Google ログインを使うため、次のステップ C がまだ必要です。

---

# ステップ C：Google の設定を本番URLに対応させる

今は Google のログイン設定が「localhost 用」になっているため、本番のURLではブロックされます。本番URLを「許可されたURL」に追加します。

## C-1. Google Cloud Console を開く

1. [https://console.cloud.google.com](https://console.cloud.google.com) を開く
2. このアプリで使っている **プロジェクト** を選択する

## C-2. OAuth の「認証情報」を開く

1. 左メニュー **「API とサービス」** → **「認証情報」** をクリック
2. **OAuth 2.0 クライアント ID** の一覧から、このアプリ用のもの（例: 「ウェブアプリケーション」）を **クリック** して開く

## C-3. 本番URLを「承認済みのリダイレクト URI」に追加する

1. **「承認済みのリダイレクト URI」** のところを探す
2. **「+ URI を追加」** をクリック
3. 次のURLを1行で入力する（〇〇は自分の Vercel のURLに置き換える）

   ```
   https://あなたの本番URL.vercel.app/api/auth/callback/google
   ```

   例: `https://gurukon-calendar-xxx.vercel.app/api/auth/callback/google`

4. **「保存」** をクリック

## C-4. 「承認済みの JavaScript 生成元」にも追加する（ある場合）

同じ画面に **「承認済みの JavaScript 生成元」** がある場合：

1. **「+ URI を追加」** をクリック
2. 本番URLを入力（**末尾にスラッシュなし**）  
   例: `https://gurukon-calendar-xxx.vercel.app`
3. **「保存」** をクリック

## C-5. 反映を待つ

変更後、数分で反映されます。すぐに試してエラーになる場合は、5分ほど待ってからもう一度、本番URLでログインを試してください。

---

# 公開後の確認（他のデバイスで使う）

1. **スマホや別のPC** のブラウザで、本番URL（例: `https://〇〇.vercel.app`）を開く
2. **「Google でログイン」** を押す
3. テストモードのままなら、**Google のテストユーザーに追加したメール** でないとログインできません  
   → 使いたいメールを Google Cloud の **OAuth 同意画面 → テストユーザー** に追加する
4. 本番公開（審査完了）後は、テストユーザー以外の Google アカウントでもログインできます

---

# よくある質問

**Q. デプロイ後に「Application error」と出る**  
- Vercel の **Deployments** でそのデプロイを開き、**「Building」** や **「Function Logs」** にエラーが出ていないか確認する  
- 環境変数（特に `NEXTAUTH_URL` と `NEXTAUTH_SECRET`）が正しく設定されているか確認する

**Q. 本番URLでログインすると「redirect_uri_mismatch」と出る**  
- ステップ C の「承認済みのリダイレクト URI」に、**完全に同じ**本番URL（`https://〇〇.vercel.app/api/auth/callback/google`）が1つ入っているか確認する  
- 余分なスペースやスラッシュがないか確認する

**Q. コードを直したあと、本番も更新したい**  
- 変更をコミットして `git push origin main` すると、Vercel が自動で再デプロイします  
- 環境変数を変えただけの場合は、Vercel の **Settings → Environment Variables** で編集し、**Redeploy** する

**Q. 本番でも「テストユーザー」だけにしたい**  
- Google の OAuth 同意画面を **「テスト」** のままにし、使いたいメールを「テストユーザー」に追加すれば、本番URLでもそのメールだけがログインできます

---

# まとめチェックリスト

- [ ] ステップ A：コードを GitHub にプッシュした
- [ ] ステップ B：Vercel でプロジェクトを作り、環境変数（NEXTAUTH_URL, NEXTAUTH_SECRET 含む）を設定してデプロイした
- [ ] ステップ C：Google の「承認済みのリダイレクト URI」に本番のコールバックURLを追加した
- [ ] 本番URLを別のデバイスで開いて、Google ログインできることを確認した

ここまでできていれば、他のデバイスからも同じ本番URLでアプリを使えます。
